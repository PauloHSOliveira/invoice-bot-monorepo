rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Users can only access their own files
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Company logos - users can upload and manage their own logos
    match /logos/{userId}/{logoId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Generated invoices - users can read their own invoices
    match /invoices/{userId}/{invoiceId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth == null; // Allow Cloud Functions to write
    }
    
    // Public invoice access (for sharing invoices with clients)
    match /public/invoices/{invoiceId} {
      allow read: if true; // Public read access for invoice sharing
      allow write: if request.auth == null; // Only Cloud Functions can write
    }
    
    // Temporary files for processing
    match /temp/{allPaths=**} {
      allow read, write: if request.auth == null; // Only Cloud Functions can access
    }
  }
}
